@using Webdiyer.WebControls.Mvc;
@using HiLand.General.Entity;
@using HiLand.Utility4.MVC;
@using HiLand.General;
@using HiLand.Utility4.MVC.Data;
@using HiLand.Utility4.MVC.Controls;
@using HiLand.Framework.BusinessCore;
@using HiLand.Framework4.Permission.Controls;
@using HiLand.Utility.Data;
@using XQYC.Business.Entity;
@using XQYC.Web.Models;
@using HiLand.Utility.Web;

@model PagedList<SalarySummaryEntity>
@{
    ViewBag.Title = "Index";
    string currentUrl = RequestHelper.CurrentFullUrl;
    string enterpriseKey = RequestHelper.GetValue("enterpriseKey");
    string salaryMonth = RequestHelper.GetValue("SalaryMonth"); 

    List<QueryConditionItem> queryItemList = new List<QueryConditionItem>();
    queryItemList.Add(new QueryConditionItem() { ConditionDisplayName = "人员名称", ConditionFieldName = "LaborName", ConditionType = typeof(string) });
    queryItemList.Add(new QueryConditionItem() { ConditionDisplayName = "工号", ConditionFieldName = "LaborCode", ConditionType = typeof(string) });
}

<h2>劳务人员薪资列表</h2>
<div id="ItemListDIV">
    <div>
        @using (Html.BeginForm())
        {
            @Html.HiQuery("LaborQuery").QueryConditionList(queryItemList).Render()
        }
    </div>
    <div class="OperateArea" id="OperateAreaContainer">
        @Html.HiA("newDisplayA").CssClassName("modalInput").Value("新建").ACA("SalaryItem", "Labor").Render(new { rel = "#EditDIV" }) | 
        @Html.HiA("salaryListCheck").CssClassName("modalInput").Value("应付薪资人员校验").ACA("SalaryListCheck", "Labor").RouteValue(new{ enterpriseKey=enterpriseKey,salaryMonth=salaryMonth}).Render()
    </div>
    <table width="98%" class="grid">
        <tr>
            <th style="width: 60px">操作
            </th>
            <th style="width: 60px">账期
            </th>
            <th style="width: 60px">状态
            </th>
            <th style="width: 80px">工号
            </th>
            <th style="width: 80px">姓名
            </th>
            <th style="width: 50px">扣税(费)前工资
            </th>
            <th style="width: 50px">各种扣费
            </th>
            <th style="width: 50px">工资税
            </th>
            <th style="width: 60px">企业常规费用(实收)
            </th>
            <th style="width: 60px">企业常规费用(计算)
            </th>
            <th style="width: 60px">个人常规费用(实扣)
            </th>
            <th style="width: 60px">个人常规费用(计算)
            </th>
            <th style="width: 80px">应付(计算)
            </th>
        </tr>
        @foreach (SalarySummaryEntity entity in Model)
        {
            string entityGuid = entity.SalarySummaryGuid.ToString();
            decimal salaryGrossPay = entity.SalaryGrossPay;
            decimal salaryrebate = entity.SalaryRebate;
            <tr>
                <td>
                    @Html.HiA().CssClassName("salaryDetailsList").Value("详情").ACA("SalaryDetailsList", "Labor").RouteValue(new { itemKey = entity.SalarySummaryGuid, returnUrl = currentUrl }).Render()
                </td>
                <td>
                    @entity.SalaryDate.ToString("yyyyMM")
                </td>
                <td>
                    @EnumHelper.GetDisplayValue(entity.SalaryPayStatus)
                </td>
                <td>
                    @entity.LaborCode
                </td>
                <td>@entity.LaborName
                </td>
                <td>@salaryGrossPay.ToString("0.00")
                </td>
                <td>@salaryrebate.ToString("0.00")
                </td>
                <td>@entity.SalaryTax.ToString("0.00")
                </td>
                <td>@entity.EnterpriseCostReal.ToString("0.00")
                </td>
                <td>@entity.EnterpriseCostCalculated.ToString("0.00")
                </td>
                <td>@entity.PersonCostReal.ToString("0.00")
                </td>
                <td>@entity.PersonCostCalculated.ToString("0.00")
                </td>
                <td>@entity.SalaryNeedPayToLabor.ToString("0.00")
                </td>
            </tr>   
        }
    </table>
    <div class="myPager">
        <span style="float: left;">@Html.Pager(Model, new PagerOptions() { PageIndexParameterName = "id", ShowDisabledPagerItems = false, AlwaysShowFirstLastPageNumber = true }) </span>
        &nbsp;(共<span>@Model.TotalItemCount</span>条/每页<span>@SystemConst.CountPerPage</span>条 当前第<span>@Model.CurrentPageIndex</span> 页/共<span>@Model.TotalPageCount</span>页)
    </div>
    <input type="hidden" id="currentPopupItemGuid" name="currentPopupItemGuid" value="" />
    <div class="modal modalFix" id="EditDIV">
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#aLaborSection").click();
            $("#aLaborSection").addClass("current");
            $("#aSalaryList").addClass("current");

            $(".modalInput").overlay({
                mask: {
                    color: '#ebecff',
                    loadSpeed: 200,
                    opacity: 0.9
                },
                closeOnClick: false
            });

            $("a.overlayClose").live("click", function () {
                $(document).simulateKeyPress('27');
                var currentItemGuid = $("#currentPopupItemGuid").val();
                $(".modalInput").overlay().close();
                $(".modalInput.edit." + currentItemGuid).overlay().close();
                $(".modalInput.password." + currentItemGuid).overlay().close();
            });

            $("#newDisplayA").click(function () {
                var enterpriseKey = "@enterpriseKey";
                var salaryMonth = "@salaryMonth";
                var url = '@Url.Action("SalaryItem")' + '?r=' + Math.random() + '&enterpriseKey=' + enterpriseKey + '&salaryMonth=' + salaryMonth;
                $("#EditDIV").load(url);
            });
        });
    </script>
</div>
